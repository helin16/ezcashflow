var ReportJs=new Class.create();ReportJs.prototype={resultPanelId:"",searchCriteria:{search:{},pagination:{pageNo:1,pageSize:30}},callbackIds:{search:"",edit:"",del:""},initialize:function(b,d,a,c){this.resultPanelId=b;this.callbackIds.search=d;this.callbackIds.edit=a;this.callbackIds.del=c},initialDatePicker:function(a){var b={};$$(a).each(function(c){b.hourString="00:00:00";b.searchPanelAttr=c.readAttribute("searchpane");if(b.searchPanelAttr!==undefined&&b.searchPanelAttr!==null){b.hourString=b.searchPanelAttr.strip().include("_start")?"00:00:00":"23:59:59"}new Prado.WebUI.TDatePicker({ID:c,InputMode:"TextBox",Format:"yyyy-MM-dd "+b.hourString,FirstDayOfWeek:1,ClassName:"datePicker",CalendarStyle:"default",FromYear:2007,UpToYear:2030})})},search:function(b){var a={};a.resultPanel=$(this.resultPanelId);a.searchPane=$(b).up(".searchPanel");a.searchCriterias={};a.searchPane.getElementsBySelector("[searchpane]").each(function(c){a.field=c.readAttribute("searchpane").strip();a.value=$F(c);a.searchCriterias[a.field]=a.value});this.searchCriteria.search=a.searchCriterias;this.searchCriteria.pagination.pageNo=1;appJs.postAjax(this.callbackIds.search,this.searchCriteria,{onLoading:function(c,d){a.resultPanel.show().down(".box-content").update('<img src="/contents/images/loading.gif" />')},onComplete:function(c,d){a.result=appJs.getResp(d);a.transCount=a.result.trans.size();if(a.accCount===0){a.resultPanel.down(".box-content").update("No Transactions Found!");return}a.resultPanel.getElementsBySelector(".noOfTrans").each(function(e){e.update(a.result.total)});a.resultPanel.down(".box-content").update("");for(a.i=0;a.i<a.transCount;a.i++){a.rowNo=(pageJs.searchCriteria.pagination.pageNo-1)*pageJs.searchCriteria.pagination.pageSize+a.i+1;a.newRow=pageJs.getRow(a.result.trans[a.i],a.rowNo);a.resultPanel.down(".box-content").insert({bottom:a.newRow})}a.resultPanel.down(".box-content").insert({bottom:pageJs.getMoreBtn(a.rowNo,a.result.total)})}})},getMoreBtn:function(c,b){var a={};if(c>=b){return}a.newMoreBtn=new Element("input",{type:"button","class":"showMoreBtn",value:"Show More Transactions"}).observe("click",function(){pageJs.getMoreTrans(this)});return a.newMoreBtn},getRow:function(b,c){var a={};a.newRow=new Element("div",{"class":"row "+(c%2===0?"even":"odd"),transId:b.id,rowno:c});console.debug(b);a.newRowContent=new Element("span",{"class":"conent"});a.newRowContent.insert({bottom:new Element("span",{"class":"fromacc"}).update("From: "+(b.fromAcc.name===undefined?"":b.fromAcc.breadCrumbs.name))});a.newRowContent.insert({bottom:new Element("span",{"class":"created"}).update(b.created)});a.newRowContent.insert({bottom:new Element("span",{"class":"toacc"}).update("To&nbsp;&nbsp;&nbsp;&nbsp;: "+b.toAcc.breadCrumbs.name)});a.newRowContent.insert({bottom:new Element("span",{"class":"value"}).update(appJs.getCurrency(b.value))});a.newRowContent.insert({bottom:new Element("span",{"class":"comments"}).update(b.comments)});a.assetsDiv=new Element("ul",{"class":"assets"});b.assets.each(function(d){a.assetsDivLi=new Element("li",{"class":"assets"});a.assetsDivLi.update(new Element("a",{"class":"assetlink",href:"/asset/"+d.assetKey,target:"_blank"}).update(d.filename));a.assetsDiv.insert({bottom:a.assetsDivLi})});a.newRowContent.insert({bottom:a.assetsDiv});a.newRow.insert({bottom:a.newRowContent});a.newRowBtns=new Element("span",{"class":"btns"});a.newRowBtns.insert({bottom:new Element("a",{"class":"btn",href:"javascript: void(0);"}).update("Edit").observe("click",function(){pageJs.showEditTrans(this,b)})});a.newRowBtns.insert({bottom:new Element("a",{"class":"btn",href:"javascript: void(0);"}).update("Delete").observe("click",function(){pageJs.delTrans(b.id)})});a.newRow.insert({bottom:a.newRowBtns});return a.newRow},getMoreTrans:function(b){var a={};a.orgianlBtnValue=$(b).value;a.resultPanel=$(this.resultPanelId);pageJs.searchCriteria.pagination.pageNo+=1;appJs.postAjax(this.callbackIds.search,this.searchCriteria,{onLoading:function(c,d){$(b).writeAttribute("value","Getting more Transactions ...").disabled=true},onComplete:function(c,f){try{a.result=appJs.getResp(f);a.transCount=a.result.trans.size();$(b).remove();for(a.i=0;a.i<a.transCount;a.i++){a.rowNo=(pageJs.searchCriteria.pagination.pageNo-1)*pageJs.searchCriteria.pagination.pageSize+a.i+1;a.newRow=pageJs.getRow(a.result.trans[a.i],a.rowNo);a.resultPanel.down(".box-content").insert({bottom:a.newRow})}a.resultPanel.down(".box-content").insert({bottom:pageJs.getMoreBtn(a.rowNo,a.result.total)})}catch(d){alert(d);if($(b)!==undefined&&$(b)!==null){$(b).writeAttribute("value",a.orgianlBtnValue).disabled=false}}}})},delTrans:function(b){var a={};if(!confirm("Are you sure you want to delete this transaction?")){return}appJs.postAjax(this.callbackIds.del,{transId:b},{onComplete:function(c,f){try{a.result=appJs.getResp(f);if(a.result.id===undefined||a.result.id===null||a.result.id.blank()){throw"System Error: trans.id not provided!"}$$(".row[transid="+a.result.id+"]").each(function(e){e.remove()})}catch(d){alert(d);if($(btn)!==undefined&&$(btn)!==null){$(btn).writeAttribute("value",a.orgianlBtnValue).disabled=false}}}})},saveTrans:function(b,c){var a={};a.row=$(b).up(".newRow");a.savingPanel=a.row.up(".newAccDiv");a.savingInfo=new Element("div").update("saving ...");a.transInfo={transId:c};a.hasError=false;a.savingPanel.getElementsBySelector(".newAccError").each(function(d){d.remove()});a.currency=/^\d*(\.|)\d{0,2}$/g;a.savingPanel.getElementsBySelector("[transinfo]").each(function(d){a.field=d.readAttribute("transinfo");a.value=$F(d);if(a.field==="date"&&a.value.blank()){d.insert({after:new Element("span",{"class":"newAccError"}).update("Date is needed!")});a.hasError=true}if(a.field==="toacc"&&a.value.blank()){d.insert({after:new Element("span",{"class":"newAccError"}).update("To Account is needed!")});a.hasError=true}if(a.field==="value"&&!a.value.match(a.currency)){d.insert({after:new Element("span",{"class":"newAccError"}).update("Invalid value, expected: 0.00!")});a.hasError=true}a.transInfo[a.field]=a.value});if(a.hasError===true){return}appJs.postAjax(this.callbackIds.edit,a.transInfo,{onLoading:function(d,e){a.row.hide().insert({after:a.savingInfo})},onComplete:function(d,g){try{a.trans=appJs.getResp(g);if(a.trans.id===undefined||a.trans.id.blank()){throw"System Error:Invalid trans id!"}a.transRow=$(b).up(".row");a.transRow.replace(pageJs.getRow(a.trans,a.transRow.readAttribute("rowno"))).scrollTo();a.savingPanel.remove()}catch(f){a.savingInfo.remove();a.row.show();alert(f)}}})},showEditTrans:function(c,b){var a={};$$(".newAccDiv").each(function(d){d.remove()});a.newDivId="edittrans_"+b.id;a.newDiv=new Element("div",{id:a.newDivId,"class":"newAccDiv"});a.newRow=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Date: ")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{transinfo:"date",type:"text","class":"transdate inputbox",placeholder:"Created Date",value:b.created}))});a.newDiv.insert({bottom:a.newRow});a.accSelect=$$('select[searchpane="fromacc"]').first();a.selectCloneFrom=new Element("select",{transinfo:"fromacc","class":"transfrom inputbox"}).update(a.accSelect.innerHTML);a.selectCloneFrom.insert({top:new Element("option",{value:""}).update("Please select ...")});if(b.fromAcc.id!==undefined&&!b.fromAcc.id.blank()){a.selectCloneFrom.down("[value="+b.fromAcc.id+"]").writeAttribute("selected","true")}else{a.selectCloneFrom.selectedIndex=0}a.newRow1=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("From: ")}).insert({bottom:new Element("span",{"class":"typein"}).update(a.selectCloneFrom)});a.newDiv.insert({bottom:a.newRow1});a.selectCloneTo=new Element("select",{transinfo:"toacc","class":"transfrom inputbox"}).update(a.accSelect.innerHTML);a.selectCloneTo.down("[value="+b.toAcc.id+"]").writeAttribute("selected","true");a.newRow2=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("To:")}).insert({bottom:new Element("span",{"class":"typein"}).update(a.selectCloneTo)});a.newDiv.insert({bottom:a.newRow2});a.newRow3=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Value: $")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{transinfo:"value",type:"text","class":"transvalue inputbox",placeholder:"Value",value:b.value}))});a.newDiv.insert({bottom:a.newRow3});a.newRow4=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Comments: ")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{transinfo:"comments",type:"text","class":"transcomments inputbox",placeholder:"Comments",value:b.comments}))});a.newDiv.insert({bottom:a.newRow4});a.newRow5=new Element("div",{"class":"newRow"}).insert({bottom:new Element("input",{"class":"submitBtn",type:"button",value:"Save"}).observe("click",function(){pageJs.saveTrans(this,b.id)})}).insert({bottom:new Element("input",{"class":"submitBtn",type:"button",value:"Cancel",style:"float:right;"}).observe("click",function(){$(a.newDivId).remove()})});a.newDiv.insert({bottom:a.newRow5});$(c).up(".row").insert({bottom:a.newDiv});pageJs.initialDatePicker("input[transinfo=date]")}};