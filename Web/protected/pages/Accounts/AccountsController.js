var AccountsJs=new Class.create();AccountsJs.prototype={rootId:1,divIds:{list:""},callBackIds:{getAccounts:"",saveAccount:"",deleteAccounts:"",moveAccounts:""},initialize:function(c,b,e,d,a){this.divIds.list=c;this.callBackIds.getAccounts=b;this.callBackIds.saveAccount=e;this.callBackIds.deleteAccounts=d;this.callBackIds.moveAccounts=a},selectAccountType:function(b){var a={};a.clickedBtn=$(b);a.clickedBtn.up("ul").getElementsBySelector("li").each(function(c){c.down("a").removeAttribute("selected")});a.clickedBtn.writeAttribute("selected")},showAccounts:function(b){var a={};this.selectAccountType(b);this.rootId=$(b).readAttribute("rootId");a.resultDivId=this.divIds.list;appJs.postAjax(this.callBackIds.getAccounts,{rootId:this.rootId},{onLoading:function(c,d){$(a.resultDivId).update('<img src="/contents/images/loading.gif" />')},onComplete:function(c,d){a.result=appJs.getResp(d);a.accCount=a.result.size();if(a.accCount===0){$(a.resultDivId).update("No Accounts Found!");return}$(a.resultDivId).update("");for(a.i=0;a.i<a.accCount;a.i++){a.newRow=pageJs.formatAccount(a.result[a.i],a.i);$(a.resultDivId).insert({bottom:a.newRow})}}});return false},formatAccount:function(c,b){var a={};a.accountId=c.id;a.newRow=new Element("div",{"class":"row "+(b%2===0?"even":"odd"),accountId:a.accountId,accountno:c.accountNumber});a.leftMargin=0;if(c.level!=0){a.leftMargin=c.level*4;a.newRow.insert({bottom:new Element("div",{"class":"space rowDivd",style:"width: "+a.leftMargin+"%"}).update("&nbsp;")})}a.rowContent=new Element("div",{"class":"content rowDivd",style:"width: "+(100-a.leftMargin-5)+"%"});a.rowContent.insert({bottom:new Element("div",{"class":"accountname"}).update(c.name)});a.rowContent.insert({bottom:new Element("div",{"class":"value"}).update(c.sum===0?"":"$"+c.sum)});a.rowContent.insert({bottom:new Element("div",{"class":"accountno"}).update(c.accountNumber)});a.rowContent.insert({bottom:new Element("div",{"class":"budget"}).update((c.budget===0||c.budget.blank())?"":"$"+c.budget)});a.rowContent.insert({bottom:new Element("div",{"class":"comments"}).update(c.comments)});a.newRow.insert({bottom:a.rowContent});a.newBtnImage=new Element("img",{src:"/contents/images/arrow-down.gif"}).observe("click",function(){pageJs.showBtnsDiv(c,this)});a.newRow.insert({bottom:new Element("div",{"class":"btns rowDivd",style:"width: 5%"}).update(a.newBtnImage)});return a.newRow},showBtnsDiv:function(c,b){var a={};a.newListDivId="btnListDiv_"+c.id;a.newListDiv=$(a.newListDivId);$$(".btnListDiv").each(function(d){d.remove()});if(a.newListDiv!==undefined&&a.newListDiv!==null){return}a.newListDiv=new Element("div",{"class":"btnListDiv",id:a.newListDivId});a.newListDivList=new Element("ul");a.listCreateNewA=new Element("a",{href:"javascript:void(0);"}).update("New").observe("click",function(){pageJs.showAcc(c,this,true)});a.newListDivList.insert({bottom:new Element("li").update(a.listCreateNewA)});if(c.level!==0){a.listCreateNewA1=new Element("a",{href:"javascript:void(0);"}).update("Edit").observe("click",function(){pageJs.showAcc(c,this,false)});a.newListDivList.insert({bottom:new Element("li").update(a.listCreateNewA1)})}if(c.gotChildren!==true){a.listCreateNewA3=new Element("a",{href:"javascript:void(0);"}).update("Delete").observe("click",function(){pageJs.delAcc(c.id,this)});a.newListDivList.insert({bottom:new Element("li").update(a.listCreateNewA3)})}a.newListDiv.update(a.newListDivList);$(b).insert({after:a.newListDiv});return a.newDiv},showAcc:function(d,c,a){var b={};$(c).up(".btnListDiv").remove();b.newDivId="accSaveDiv_"+d.id;$$(".newAccDiv").each(function(e){e.remove()});b.newDiv=$(b.newDivId);b.accName=b.comments=b.accId=b.parentId="";b.accValue=b.accBudget="0.00";if(a===true){b.parentId=d.id}else{b.accName=d.name;b.accValue=d.value;b.accBudget=d.budget;b.accId=d.id;b.comments=d.comments;b.parentId=""}b.newDiv=new Element("div",{id:b.newDivId,"class":"newAccDiv"});b.newRowTitle=new Element("div",{"class":"newRow"}).insert({bottom:new Element("div",{"class":"title"}).update(a===true?"Creating a new Account":"Updating selected account")});b.newDiv.insert({bottom:b.newRowTitle});b.newRow=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Name: ")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{accinfo:"name",type:"text","class":"accName inputbox",placeholder:"Account Name",value:b.accName}))});b.newDiv.insert({bottom:b.newRow});b.newRow1=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Value: $")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{accinfo:"value",type:"text","class":"accValue inputbox",placeholder:"Account Value",value:b.accValue}))});b.newDiv.insert({bottom:b.newRow1});b.newRow2=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Budget: $")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{accinfo:"budget",type:"text","class":"accBudget inputbox",placeholder:"Account Budget",value:b.accBudget}))});b.newDiv.insert({bottom:b.newRow2});b.newRow2=new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label"}).update("Comments: ")}).insert({bottom:new Element("span",{"class":"typein"}).update(new Element("input",{accinfo:"comments",type:"text","class":"accComments inputbox",placeholder:"Comments",value:b.comments}))});b.newDiv.insert({bottom:b.newRow2});b.newRow3=new Element("div",{"class":"newRow"}).insert({bottom:new Element("input",{"class":"submitBtn",type:"button",value:"Save"}).observe("click",function(){pageJs.saveAccount(this,b.accId,b.parentId)})}).insert({bottom:new Element("input",{"class":"submitBtn",type:"button",value:"Cancel",style:"float:right;"}).observe("click",function(){$(b.newDivId).remove()})});b.newDiv.insert({bottom:b.newRow3});$$(".row[accountId="+d.id+"]").first().insert({bottom:b.newDiv})},saveAccount:function(c,a,d){var b={};b.row=$(c).up(".newRow");b.savingPanel=b.row.up(".newAccDiv");b.savingInfo=new Element("div").update("saving ...");b.accInfo={accountId:a,parentId:d};b.hasError=false;b.savingPanel.getElementsBySelector(".newAccError").each(function(e){e.remove()});b.currency=/^\d*(\.|)\d{0,2}$/g;b.savingPanel.getElementsBySelector("[accinfo]").each(function(e){b.field=e.readAttribute("accinfo");b.value=$F(e);if(b.field==="name"&&b.value.blank()){e.insert({after:new Element("span",{"class":"newAccError"}).update("Name is needed!")});b.hasError=true}if(b.field==="value"&&!b.value.match(b.currency)){e.insert({after:new Element("span",{"class":"newAccError"}).update("Invalid value, expected: 0.00!")});b.hasError=true}if(b.field==="budget"&&!b.value.match(b.currency)){e.insert({after:new Element("span",{"class":"newAccError"}).update("Invalid budget, expected: 0.00!")});b.hasError=true}b.accInfo[b.field]=$F(e)});if(b.hasError===true){return}appJs.postAjax(this.callBackIds.saveAccount,b.accInfo,{onLoading:function(e,f){b.row.hide().insert({after:b.savingInfo})},onComplete:function(f,h){try{b.acc=appJs.getResp(h);if(b.acc.accountNumber===undefined||b.acc.accountNumber.blank()){throw"System Error:Invalid account number!"}if(a!==b.acc.id){b.accountNumber=b.acc.accountNumber-1;b.lastRow=$$(".row[accountno="+b.accountNumber+"]").last();if(b.lastRow===undefined||b.lastRow===null){b.lastRow=b.row.up(".row")}b.lastRow.insert({after:pageJs.formatAccount(b.acc)}).scrollTo()}else{$$(".row[accountid="+b.acc.id+"]").first().replace(pageJs.formatAccount(b.acc)).scrollTo()}alert("Saved successfully!");b.savingPanel.remove()}catch(g){b.savingInfo.remove();b.row.show();alert(g)}}})},delAcc:function(a,c){var b={};if(!confirm("Are you sure you want to delete this account?")){return}$(c).up(".btnListDiv").remove();appJs.postAjax(this.callBackIds.deleteAccounts,{accountId:a},{onComplete:function(d,g){try{b.acc=appJs.getResp(g);if(b.acc.id===undefined||b.acc.id.blank()){throw"System Error:Invalid account id!"}$$(".row[accountid="+b.acc.id+"]").first().remove();if(b.acc.parent.id!==undefined&&!b.acc.parent.id.blank()){$$(".row[accountid="+b.acc.parent.id+"]").first().replace(pageJs.formatAccount(b.acc.parent))}}catch(f){alert(f)}}})}};