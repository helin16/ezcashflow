var PropertiesJs=new Class.create();PropertiesJs.prototype={states:null,pagination:{pageSize:30,pageNumber:1},divIds:{list:""},callBackIds:{get:"",save:"",del:"",getAcc:""},initialize:function(d,a,c,e,b){this.divIds.list=d;this.callBackIds.get=a;this.callBackIds.save=c;this.callBackIds.del=e;this.callBackIds.getAcc=b},loadProperties:function(){var a={};a.me=this;appJs.postAjax(this.callBackIds.get,{pagination:a.me.pagination},{onLoading:function(b,c){$(a.me.divIds.list).update('<img src="/contents/images/loading.gif" />')},onComplete:function(b,c){a.result=appJs.getResp(c);a.count=a.result.properties.size();if(a.accCount===0){$(a.me.divIds.list).update("No Property Found!");return}$(a.me.divIds.list).up(".content-box").getElementsBySelector(".noOfItems").each(function(d){d.update(a.result.total)});a.headerRow=new Element("div",{"class":"property row header"}).update(a.me._getValueRow("","Bought","Setup","Income","(%)","Expense","Profit"));$(a.me.divIds.list).update(a.headerRow);for(a.i=0;a.i<a.count;a.i++){a.rowNo=(a.me.pagination.pageNumber-1)*a.me.pagination.pageSize+a.i+1;$(a.me.divIds.list).insert({bottom:a.me._getPropertyRow(a.result.properties[a.i]).addClassName(a.rowNo%2===0?"odd":"even")})}$(a.me.divIds.list).insert({bottom:a.me._getMoreBtn(a.rowNo,a.result.total)})}})},_getMoreBtn:function(c,b){var a={};if(c===0||c>=b){return}a.me=this;a.newMoreBtn=new Element("input",{type:"button","class":"showMoreBtn",value:"Show More Property"}).observe("click",function(){a.me.getMore(this)});return a.newMoreBtn},getMore:function(b){var a={};a.me=this;a.orgianlBtnValue=$(b).value;a.me.pagination.pageNumber+=1;appJs.postAjax(this.callBackIds.get,{pagination:a.me.pagination},{onLoading:function(c,d){$(b).writeAttribute("value","Getting more ...").disabled=true},onComplete:function(c,f){try{a.result=appJs.getResp(f,false,true);a.transCount=a.result.properties.size();$(b).remove();for(a.i=0;a.i<a.transCount;a.i++){a.rowNo=(a.me.pagination.pageNumber-1)*a.me.pagination.pageSize+a.i+1;$(a.me.divIds.list).insert({bottom:a.me._getPropertyRow(a.result.properties[a.i],a.rowNo).addClassName(a.rowNo%2===0?"odd":"even")})}$(a.me.divIds.list).insert({bottom:a.me._getMoreBtn(a.rowNo,a.result.total)})}catch(d){alert(d);if($(b)!==undefined&&$(b)!==null){$(b).writeAttribute("value",a.orgianlBtnValue).disabled=false}}}})},_getValueRow:function(f,d,a,e,g,c,b){return new Element("div",{"class":"values"}).insert({bottom:new Element("span",{"class":"title"}).update(f)}).insert({bottom:new Element("span",{"class":"boughtvalue"}).update(d)}).insert({bottom:new Element("span",{"class":"setup"}).update(a)}).insert({bottom:new Element("span",{"class":"income"}).update(e)}).insert({bottom:new Element("span",{"class":"returnpercentage"}).update(g)}).insert({bottom:new Element("span",{"class":"outgoing"}).update(c)}).insert({bottom:new Element("span",{"class":"profit"}).update(b)})},_makeUrl:function(e,a,c,d){var b={};b.array={fromAccountIds:d!==undefined?d:[],toAccountIds:c,fromDate:e,toDate:a};return"/reports/"+Object.toJSON(b.array)},_getPropertyRow:function(b){var a={};a.me=this;a.assetsUl=new Element("ul",{"class":"assetslist"});b.assets.each(function(c){a.assetsUl.insert({bottom:new Element("li",{"class":"assets inlineblock"}).update(new Element("a",{"class":"assetlink",href:"/asset/"+c.assetKey,target:"_blank"}).update(c.filename))})});return new Element("div",{"class":"property row"}).insert({bottom:new Element("div",{"class":"summary"}).insert({bottom:new Element("span",{"class":"address"}).update(b.address.full)}).observe("click",function(){a.row=$(this).up(".property");if(a.me.states!==null){a.me._showPropertyPanel(b,a.row);return}appJs.postAjax(a.me.callBackIds.getAcc,{},{onLoading:function(c,d){a.row.insert({bottom:new Element("div",{"class":"editDiv newAccDiv"}).update('Getting states...<img src="/contents/images/loading.gif" />')})},onComplete:function(c,d){a.result=appJs.getResp(d);a.me.states=a.result.states;a.me._showPropertyPanel(b,a.row)}})})}).insert({bottom:a.me._getFYDiv("Current FY: ",b.currentFY,b.boughtValue,b.setupAcc.sum)}).insert({bottom:a.me._getFYDiv("Last FY: ",b.lastFY,b.boughtValue,b.setupAcc.sum)}).insert({bottom:this._getTotalDiv("Total: ",b)}).insert({bottom:new Element("div",{"class":"comments smlTxt alignLeft fullwidth"}).update(b.comments)}).insert({bottom:new Element("div",{"class":"assets smlTxt alignLeft fullwidth"}).update(a.assetsUl)})},_showPropertyPanel:function(c,b){var a={};a.me=this;$$(".editDiv").each(function(d){d.remove()});a.pId=(c.id||"");a.boughtValue=(c.boughtValue||"");a.comments=(c.comments||"");a.setupAcc=(c.setupAcc||null);a.incomeAcc=(c.incomeAcc||null);a.outgoingAcc=(c.outgoingAcc||null);a.addrLine1=(c.address.line1||"");a.addrSuburb=(c.address.suburb||"");a.addrState=(c.address.state||"");a.addrPostCode=(c.address.postCode||"");a.stateSelectBox=new Element("select",{"class":"fullwidth",editaddr:"stateId"});$H(a.me.states).each(function(d){a.option=new Element("option",{value:d.key}).update(d.value.name+" ("+d.value.country.name+")");if(d.value.id===a.addrState.id){a.option.writeAttribute("selected",true)}a.stateSelectBox.insert({bottom:a.option})});a.fileUploaderWrapperId="attachments_"+a.pId;a.newDiv=new Element("div",{"class":"editDiv newAccDiv",propid:a.pId}).insert({bottom:a.me._getShowPropertyRow("Bought: $",new Element("input",{"class":"inputbox fullwidth",editpane:"boughtValue",value:a.boughtValue}).writeAttribute("placeholder","The amount of money when assign contract"))}).insert({bottom:a.me._getShowPropertyRow("Setup Acc: ",a.me._getAccListBox([4],a.setupAcc).writeAttribute("editpane","setupAcc"))}).insert({bottom:a.me._getShowPropertyRow("Income Acc: ",a.me._getAccListBox([3],a.incomeAcc).writeAttribute("editpane","incomeAcc"))}).insert({bottom:a.me._getShowPropertyRow("Expense Acc: ",a.me._getAccListBox([4],a.outgoingAcc).writeAttribute("editpane","outgoingAcc"))}).insert({bottom:a.me._getShowPropertyRow("Comments: ",new Element("input",{"class":"inputbox fullwidth",editpane:"comments",value:a.comments}).writeAttribute("placeholder","Some comments"))}).insert({bottom:a.me._getShowPropertyRow("Address: ",new Element("div",{"class":"fullwidth address"}).insert({bottom:new Element("span").update("Addr.: ")}).insert({bottom:new Element("input",{"class":"fullwidth",editaddr:"line1",value:a.addrLine1})}).insert({bottom:new Element("div",{"class":"fullwidth"}).insert({bottom:new Element("span",{"class":"inlineblock suburb"}).insert({bottom:new Element("span").update("Suburb: ")}).insert({bottom:new Element("input",{"class":"fullwidth",editaddr:"suburb",value:a.addrSuburb})})}).insert({bottom:new Element("span",{"class":"inlineblock postcode"}).insert({bottom:new Element("span").update("PostCode: ")}).insert({bottom:new Element("input",{"class":"fullwidth",editaddr:"postcode",value:a.addrPostCode})})}).insert({bottom:new Element("span",{"class":"inlineblock state"}).insert({bottom:new Element("span").update("State: ")}).insert({bottom:a.stateSelectBox})})}))}).insert({bottom:a.me._getShowPropertyRow("Attachments: ",new Element("div").insert({bottom:a.me._getAssetListDiv(c.assets)}).insert({bottom:new Element("span",{attachments:"attachments",id:a.fileUploaderWrapperId})}))}).insert({bottom:new Element("div",{"class":"newRow btns"}).insert({bottom:new Element("input",{"class":"submitBtn",type:"button",value:"Save"}).observe("click",function(){a.me._submitProperty(this)})}).insert({bottom:new Element("input",{"class":"submitBtn",type:"button",value:"Cancel",style:"float:right;"}).observe("click",function(){$(this).up(".newAccDiv").remove()})})});if(a.pId!==""){a.newDiv.insert({bottom:new Element("input",{type:"hidden",value:a.pId,editpane:"id"})})}b.insert({bottom:a.newDiv});a.fileHandler=new FileUploaderJs(a.fileUploaderWrapperId).initFileUploader();a.newDiv.store("fileHandler",a.fileHandler);return this},_getAssetListDiv:function(b){var a={};a.div=new Element("div",{"class":"assets uploadedFileList",assets:"assets"});b.each(function(c){a.div.insert({bottom:new Element("div",{"class":"uploadedfile",assetkey:c.assetKey}).update(c.filename).insert({bottom:new Element("span",{"class":"delFile"}).update("x").observe("click",function(){if(!confirm("Are you sure you want to delete this asset?")){return}$(this).up(".uploadedfile").hide().writeAttribute("delete",true)})})})});return a.div},_submitProperty:function(b){var a={};a.me=this;a.row=$(b).up(".editDiv");a.requestData={address:{},assets:{}};a.row.getElementsBySelector("[editpane]").each(function(c){a.requestData[c.readAttribute("editpane")]=$F(c)});a.row.getElementsBySelector("[editaddr]").each(function(c){a.requestData.address[c.readAttribute("editaddr")]=$F(c)});a.assets={};a.row.getElementsBySelector(".uploadedfile").each(function(c){a.assets[c.readAttribute("assetkey")]=(c.readAttribute("delete")?false:true)});a.requestData.assets.assets=a.assets;a.requestData.assets.attachments=a.row.retrieve("fileHandler").uploadedFiles;a.savingInfo=new Element("div").update("saving ...");appJs.postAjax(a.me.callBackIds.save,a.requestData,{onLoading:function(c,d){a.row.down(".btns").hide().insert({after:a.savingInfo})},onComplete:function(c,f){try{a.property=appJs.getResp(f,false,true);if(a.property.id===undefined||a.property.id.blank()){throw"System Error:Invalid property id!"}a.propRow=a.row.up(".property");a.oddRow=a.propRow.hasClassName("odd")?"odd":"even";a.propRow.replace(a.me._getPropertyRow(a.property).addClassName(a.oddRow)).scrollTo();a.row.remove()}catch(d){a.savingInfo.remove();a.row.down(".btns").show();alert(d)}}});return this},_getAccListBox:function(c,b){var a={};a.me=this;a.selectBox=new Element("select",{"class":"inputbox fullwidth"});a.shownSelectedAccount=(b===undefined||b===null?true:false);a.accounts=appJs.getPageData("accounts");c.each(function(d){a.selectBox.insert({bottom:new Element("optgroup",{label:a.accounts[d][d].name})});$H(a.accounts[d]).each(function(e){a.option=new Element("option",{value:e.key}).update(e.value.breadCrumbs.name+" - "+appJs.getCurrency(e.value.sum));if(e.key===b.id){a.option.writeAttribute("selected",true);a.shownSelectedAccount=true}a.selectBox.insert({bottom:a.option})})});if(a.shownSelectedAccount===false){a.selectBox.insert({top:new Element("option",{value:b.id}).update(b.breadCrumbs.name+" - "+appJs.getCurrency(b.sum))})}return a.selectBox},_getShowPropertyRow:function(b,a){return new Element("div",{"class":"newRow"}).insert({bottom:new Element("span",{"class":"label inlineblock valignTop"}).update(b)}).insert({bottom:new Element("span",{"class":"typein inlineblock"}).update(a)})},_getFYDiv:function(e,d,c,b){var a={};a.me=this;a.incomeAcc=d.income;a.outgoingAcc=d.outgoing;a.profit=a.incomeAcc-a.outgoingAcc;return this._getValueRow((new Element("span").update(new Element("div",{"class":"titlecontent",title:(d.date.from+" ~ "+d.date.to)}).update(e))),appJs.getCurrency(c),appJs.getCurrency(b),(new Element("a",{href:a.me._makeUrl(d.date.from,d.date.to,d.incomeAccIds)}).update(appJs.getCurrency(a.incomeAcc))),"("+(Math.round(d.boughtValue)===0?0:((a.incomeAcc/d.boughtValue)*100).toFixed(2))+"%)",(new Element("a",{href:a.me._makeUrl(d.date.from,d.date.to,d.outgoingAccIds)}).update(appJs.getCurrency(a.outgoingAcc))),(a.profit>=0?appJs.getCurrency(a.profit):new Element("span",{"class":"minusCurrency"}).update(appJs.getCurrency(a.profit))))},_getTotalDiv:function(c,b){var a={};a.incomeAcc=b.incomeAcc.sum;a.outgoingAcc=b.outgoingAcc.sum;a.profit=a.incomeAcc-a.outgoingAcc;a.profit=a.profit>=0?appJs.getCurrency(a.profit):new Element("span",{"class":"minusCurrency"}).update(appJs.getCurrency(a.profit));a.returnP="("+(Math.round(b.boughtValue)===0?0:((a.incomeAcc/b.boughtValue)*100).toFixed(2))+"%)";return this._getValueRow(c,appJs.getCurrency(b.boughtValue),appJs.getCurrency(b.setupAcc.sum),appJs.getCurrency(a.incomeAcc),a.returnP,appJs.getCurrency(a.outgoingAcc),a.profit)}};