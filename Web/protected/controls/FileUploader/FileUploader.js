var FileUploaderJs=new Class.create();FileUploaderJs.prototype={serverUrl:"",totalWrapperId:"",uploadedFiles:{},initialize:function(b,a){this.totalWrapperId=b;this.serverUrl=(!a?"/asset/upload":"")},_getInitHtml:function(){var a={};$(this.totalWrapperId).update(new Element("div",{"class":"fileUploadWrapper"}).insert({bottom:new Element("input",{"class":"fileInitBtn",type:"file",name:"files[]","data-url":this.serverUrl,multiple:""})}).insert({bottom:new Element("div",{"class":"progressBarDiv"}).update(new Element("div",{"class":"bar",style:"width: 0%"}))}).insert({bottom:new Element("div",{"class":"uploadedFileList"})}))},reset:function(){$(this.totalWrapperId).down(".fileUploadWrapper").update("");this.uploadedFiles={}},initFileUploader:function(){this._getInitHtml();var a={};a.me=this;$j("#"+this.totalWrapperId+" .fileInitBtn[type=file]").fileupload({dataType:"json",done:function(c,b){$j.each(b.result.files,function(d,e){$j("<div class='uploadedfile' filepath='"+e.filepath+"'/>").html(e.name).append($j('<span class="delFile" />').html("x").click(function(){a.me.delFile(this)})).appendTo($j("#"+a.me.totalWrapperId+" .uploadedFileList"));a.me.uploadedFiles[e.filepath]=e})},progressall:function(c,b){a.progress=parseInt(b.loaded/b.total*100,10);a.barDiv=$j("#"+a.me.totalWrapperId+" .progressBarDiv .bar").css("width",a.progress+"%").html("");if(a.progress<100){a.barDiv.append($j('<span class="barTxt" />').html(a.progress+"%"))}}})},delFile:function(b){if(!confirm("Are you sure you want to delete this uploaded file?")){return}var a={};a.me=this;a.fileItemDiv=$(b).up(".uploadedfile");delete a.me.uploadedFiles[a.fileItemDiv.readAttribute("filepath")];a.fileItemDiv.remove()}};