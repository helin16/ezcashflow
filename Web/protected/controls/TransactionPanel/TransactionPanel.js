var TransPaneJs=new Class.create();TransPaneJs.prototype={accountIds:{from:[],to:[]},formDivId:"",callbackIds:{getAccounts:"",saveTrans:"",delFileCBId:""},fileUploader:null,initialize:function(b,c,d,e,a){this.formDivId=b;this.callbackIds.getAccounts=c;this.callbackIds.saveTrans=d;this.callbackIds.delFileCBId=e;this.fileUploader=new FileUploaderJs(a)},buildFrom:function(c,a){var b={};b.me=this;this.accountIds.from=c;this.accountIds.to=a;b.formDivId=this.formDivId;b.fromAccListBox=$(b.formDivId).down("[transpane=fromAccounts]");b.toAccListBox=$(b.formDivId).down("[transpane=toAccounts]");b.valueBox=$(b.formDivId).down("[transpane=value]");b.commentsBox=$(b.formDivId).down("[transpane=description]");b.saveBtn=$(b.formDivId).down("[transpane=saveBtn]");b.saveBtnValue=b.saveBtn.value;appJs.postAjax(this.callbackIds.getAccounts,{fromIds:c,toIds:a},{onLoading:function(d,e){b.fromAccListBox.update(new Element("option").update("Loading ..."));b.toAccListBox.update(new Element("option").update("Loading ..."));b.commentsBox.value=b.valueBox.value="";b.saveBtn.value="Loading ...";b.saveBtn.disabled=true},onComplete:function(d,e){b.result=appJs.getResp(e);b.me.getAccList(b.result.from,b.fromAccListBox);b.me.getAccList(b.result.to,b.toAccListBox);b.saveBtn.value=b.saveBtnValue;b.saveBtn.disabled=false}});return false},getAccList:function(b,c){var a={};$(c).update("");$H(b).each(function(d){a.rootName=d.key;a.optGroup=new Element("optgroup",{label:a.rootName});$H(d.value).each(function(e){a.optGroup.insert({bottom:new Element("option",{value:e.value.id}).update(e.value.breadCrumbs.name.replace(a.rootName+" / ","")+" - $"+e.value.sum)})});$(c).insert({bottom:a.optGroup})})},stripValue:function(a){return a.strip().replace(" ","").replace("$","").replace(",","")},saveTrans:function(btn,postJs){var tmp={};tmp.me=this;tmp.form=$(btn).up("div.transDiv");tmp.fromAccListBox=tmp.form.down("[transpane=fromAccounts]");tmp.toAccListBox=tmp.form.down("[transpane=toAccounts]");tmp.valueBox=tmp.form.down("[transpane=value]");tmp.commentsBox=tmp.form.down("[transpane=description]");tmp.assets=tmp.form.down("[transpane=assets]");tmp.saveBtn=tmp.form.down("[transpane=saveBtn]");if(this.validForm(tmp.fromAccListBox,tmp.toAccListBox,tmp.valueBox)===false){return false}tmp.saveBtnValue=tmp.saveBtn.value;try{tmp.assetsJson=$F(tmp.assets).evalJSON()}catch(e){tmp.assetsJson={}}tmp.data={fromAccId:$F(tmp.fromAccListBox),toAccId:$F(tmp.toAccListBox),value:tmp.me.stripValue($F(tmp.valueBox)),comments:$F(tmp.commentsBox).strip(),fromIds:this.accountIds.from,toIds:this.accountIds.to,assets:tmp.me.fileUploader.uploadedFiles};appJs.postAjax(this.callbackIds.saveTrans,tmp.data,{onLoading:function(sender,param){tmp.saveBtn.value="Saving ...";tmp.saveBtn.disabled=true},onComplete:function(sender,param){try{tmp.result=appJs.getResp(param,false,true);tmp.me.getAccList(tmp.result.from,tmp.fromAccListBox);tmp.me.getAccList(tmp.result.to,tmp.toAccListBox);tmp.commentsBox.value=tmp.valueBox.value="";tmp.me.fileUploader.reset();tmp.saveBtn.value=tmp.saveBtnValue;tmp.saveBtn.disabled=false;alert("Saved Successfully!");if(postJs!==undefined){eval(postJs)}}catch(e){alert(e);tmp.saveBtn.value=tmp.saveBtnValue;tmp.saveBtn.disabled=false}}})},validForm:function(c,d,b){var a={};a.me=this;a.succ=true;$(c).up("div.transDiv").getElementsBySelector(".errorMsg").each(function(e){e.remove()});if($F(c).blank()||$F(c)<=0){$(c).up("div.row").down("span.title").insert({bottom:new Element("span",{"class":"errorMsg"}).update("Invalid From")});a.succ=false}if($F(d).blank()||$F(d)<=0){$(d).up("div.row").down("span.title").insert({bottom:new Element("span",{"class":"errorMsg"}).update("Invalid To")});a.succ=false}a.regex=/^(\d+)(\.\d{1,2})?$/;if(!a.me.stripValue($F(b)).match(a.regex)){$(b).up("div.row").down("span.title").insert({bottom:new Element("span",{"class":"errorMsg"}).update("Invalid Value"+a.me.stripValue($F(b)))});a.succ=false}return a.succ},toggleFileList:function(a){if($(a).checked){this.fileUploader.initFileUploader()}else{this.fileUploader.reset()}return true}};